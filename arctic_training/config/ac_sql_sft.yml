type: sft
micro_batch_size: 1
epochs: 3
activation_checkpoint_cpu_offload: true

model:
  type: liger
  name_or_path: /modeling-checkpoints/zheweiyao/persist_for_snowflake_text2sql/mid-training-sqlite-13A-32B-packing-H200-global_step_28740
  attn_implementation: flash_attention_3

data:
  sources:
    # TODO: Update path once dataset is generated using csv_to_huggingface_dataset.py
    - type: huggingface_instruct
      name_or_path: /home/yak/data/input
      role_mapping:
        user: messages.role.user
        assistant: messages.role.assistant

  eval_sources:
    # TODO: Update path once validation dataset is generated using csv_to_huggingface_dataset.py
    - type: huggingface_instruct
      name_or_path: /home/yak/data/validation
      role_mapping:
        user: messages.role.user
        assistant: messages.role.assistant

  num_proc: 16
  max_length: 32768
  cache_dir: /checkpoint/aponnusamy/data-cache
  pack_samples: true
  ignore_empty_think: false
  fim_loss_masking: true

# Evaluation interval - required when eval_sources is provided
eval_interval: 50

deepspeed:
  zero_optimization:
    stage: 3
    allgather_bucket_size: 500000000
    reduce_bucket_size: 250000000
    memory_efficient_linear: true

optimizer:
  weight_decay: 0.01
  learning_rate: 1e-5

scheduler:
  type: huggingface
  name: cosine_with_min_lr
  warmup_ratio: 0.1
  scheduler_specific_kwargs:
    min_lr_rate: 0.1

checkpoint:
  - type: huggingface
    save_every_n_steps: 150
    save_end_of_training: true
    output_dir: /modeling-checkpoints/aponnusamy/checkpoints/qwen3-32b-ac-sft-1220

wandb:
  enable: true
  project: snowflakesql_sft_training
  name: qwen3-32b-ac-sft-1220

logger:
  level: WARNING
  output_dir: logs
  print_output_ranks: [0]
